# CompanyHub - Advanced Elicitation Session Results

*Generated by Mary (Business Analyst) - Advanced Elicitation Session*
*Date: 2025-07-21*

## Project Overview Summary

**CompanyHub** is a developer-focused API aggregation service providing unified access to Polish company data from multiple government sources (REGON, MF, planned VIES) with value-added features like data enrichment, historical tracking, and webhook notifications.

### Current State
- **Implemented:** REGON & MF integration, user registration/search functional, staging-ready core features
- **Missing:** VIES integration, API tokens, subscription plans, webhooks
- **Architecture:** FastAPI backend, Next.js frontend, Redis caching, planned Celery for async processing

### Business Model
- **Monetization:** Tiered subscriptions with API call limits, webhooks in premium tiers
- **Target Users:** Developers integrating company data into their applications
- **Value Proposition:** Unified API + webhook notifications to prevent stale data + historical tracking
- **Competitive Landscape:** Unknown competitors, differentiated by webhook capabilities

## Key Technical Requirements

### Data Sources & Integration
1. **REGON (GUS API)** - Polish business registry (âœ… Implemented)
2. **MF (BiaÅ‚a Lista)** - Polish VAT whitelist (âœ… Implemented) 
3. **VIES** - EU VAT validation system (ðŸ”„ Planned)
4. **IBAN API** - Bank account enrichment for MF data (ðŸ”„ Planned)

### Caching & Performance Strategy
- **Cache Duration:** 1 month default with configurable refresh
- **Response Options:** Cached (faster, cheaper) vs Fresh data
- **Rate Limit Handling:** Return cached data + provider status when upstream limited
- **Storage:** Historical data tracking with diffs and timestamps

### Planned Features
- **API Tokens:** Authentication and usage tracking
- **Subscription Plans:** Tiered pricing with call limits
- **Webhooks:** Configurable notifications for data changes, status updates
- **Batch Processing:** Bulk company lookups with optimized provider usage

## Stakeholder Round Table Insights

### Senior Backend Developer (Customer Perspective)
**Pain Points:**
- Rate limits on direct API calls (10,000+ companies/month to validate)
- Data inconsistencies between sources requiring manual reconciliation
- Custom caching system maintenance overhead

**Value Assessment:**
- Unified API saves 3 weeks integration per new data source
- Webhooks critical for real-time updates (currently polling hourly)
- Historical tracking could replace custom audit system

**Concerns:**
- Reliability when CompanyHub hits upstream rate limits
- Webhook reliability for compliance-critical applications
- Pricing competitiveness (currently ~â‚¬200/month across sources)

### CTO at FinTech (Enterprise Buyer)
**Requirements:**
- SLA guarantees (99.9% uptime minimum)
- SOC2/GDPR compliance documentation
- Mission-critical webhook reliability

**Budget Reality:**
- â‚¬1000+/month budget for enterprise features
- Need volume discounts and clear ROI
- Want dedicated support and possible on-premise deployment

**Integration Needs:**
- Sandbox environment for testing
- Integration with existing monitoring/alerting
- Stable API versioning strategy

### Technical Architect (Infrastructure Perspective)
**Scalability Concerns:**
- 1-month caching storage strategy and costs
- Cache invalidation across multiple data sources
- Webhook delivery guarantees and retry policies

**Technical Validation:**
- Rate limiting transparency needs status endpoints
- IBAN enrichment latency requires batch processing
- API token management needs proper JWT/OAuth2

**Integration Architecture:**
- SDK/client libraries essential for production use
- OpenAPI + code examples in multiple languages
- Monitoring/metrics endpoints for troubleshooting

## Critical Success Factors Identified

1. **Reliability > Features** - SLA guarantees more important than feature richness
2. **Transparent Rate Limiting** - Clear status on upstream provider limits
3. **Webhook Reliability** - Mission-critical for real-time business processes
4. **Pricing Transparency** - Volume discounts and ROI clarity essential

## Rate Limiting Strategy Design (Tree of Thoughts Analysis)

### Dual-Layer Rate Limiting Strategy

**Layer 1: User Subscription Limits**
- Basic Plan: 1,000 requests/month (33/day average, 50/hour burst)
- Pro Plan: 10,000 requests/month (333/day average, 100/hour burst) + webhooks
- Enterprise: Custom limits + batch processing + priority queues

**Layer 2: Provider-Aware Response Strategy**
```python
def handle_request(nip, refresh=False):
    # Always check cache first
    cached_data = get_cache(nip)
    
    if cached_data and not refresh:
        return success_response(cached_data, source="cache")
    
    # Check provider quotas
    provider_status = check_all_provider_limits()
    
    if any_provider_limited(provider_status):
        if cached_data:
            return partial_response(cached_data, provider_status)
        else:
            return rate_limited_response(provider_status, retry_after=calculate_retry())
    
    # Proceed with fresh data fetch
    return fetch_and_cache(nip)
```

### Batch Processing Enhancement
- **Endpoint:** `POST /api/v1/companies/batch`
- **Strategy:** Intelligent provider distribution across batch items
- **Notification:** Webhook `batch.completed` with results array
- **Pricing:** Batch requests count as 0.8x individual requests
- **Benefits:** 40-60% provider API usage savings through intelligent routing

### Risk Mitigation
1. **Cache stampede** - Implement jittered retry when provider limits reset
2. **Webhook delivery failures** - Retry queue with exponential backoff
3. **Partial batch failures** - Return success/failure status per item
4. **Rate limit gaming** - Track batch explosion abuse (1 batch = 100 items)

## Documentation Priorities

### Critical Documentation Needs
1. **SLA/Reliability commitments** - Uptime, response times, webhook delivery guarantees
2. **Integration timeline breakdown** - Actual time savings vs manual integration
3. **Pricing calculator** - Help prospects understand costs at their scale
4. **Compliance documentation** - GDPR, data retention, security practices

### Additional Documentation
- Integration guides for common use cases
- Business case documentation and ROI analysis
- SDK/client library documentation
- Comprehensive API reference (beyond FastAPI auto-generated docs)

## Feature Gaps Identified

### Enterprise Features
- Dedicated support channels
- On-premise deployment options
- Priority processing queues
- Custom SLA agreements

### Monitoring & Operations
- Status pages and health checks
- Metrics APIs for customer monitoring
- Integration with popular monitoring tools
- Webhook delivery status tracking

### Developer Experience
- SDK/client libraries for major languages
- Sandbox/testing environments
- Enhanced error messages and debugging tools
- Migration guides for API version updates

## Next Steps for PRD Creation

1. **Feature Prioritization** - Map stakeholder needs to development roadmap
2. **Technical Specifications** - Detail batch processing and rate limiting implementation
3. **Business Model Validation** - Confirm pricing strategy against competitor analysis
4. **Compliance Requirements** - Document GDPR, data retention, and security practices
5. **Success Metrics Definition** - KPIs for reliability, performance, and customer satisfaction

---

*This elicitation session captured comprehensive stakeholder perspectives and identified critical technical and business requirements for CompanyHub's product documentation and development roadmap.*